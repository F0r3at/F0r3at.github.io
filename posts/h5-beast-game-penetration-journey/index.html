<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>H5神兽棋牌游戏渗透之旅 - F0rmat&#39;Blog</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
</head>
<body>
<header>
  <div>
    <h1><a href="https://getshe11.com/">F0rmat&#39;Blog</a></h1>
  </div>
  <nav></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>H5神兽棋牌游戏渗透之旅</h1>
  </div>
<div style="position: fixed; right:-30px; max-width:300px; overflow:auto; top: 1px; width: 300px; bottom:100px">

</div>
<div class="meta">
  <div>2018-05-11 22:14</div>
  </div>
<div class="content">
  <h2 id="0x01-前言">0x01 前言</h2>
<p>本来不想发的，涉及太多利益了,这些棋牌游戏的源码最高能卖到几万。开发起来不比一个商场程序难。
最近又太忙了，没时间去做代码审计的文章了，但一不小心又抢了个运气王。。。</p>
<h2 id="0x02-开始">0x02 开始</h2>
<p>一天做这行的朋友来找我，说帮审计下一套程序，正好这边的缺一篇文章就顺便去看看了。
开始看了下目录，找了几个用这套源码的平台来测试,看了下里面的功能。</p>
<!-- raw HTML omitted -->
<p>这套源码用的框架是基于Thinkphp3.2的Thinkcmf的，现在的Thinkcmf已经更新到了基于Thinkphp5.0了，之前没做过H5的代码审计，看到现在H5发展很快，基本都可以抛弃flash了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/1.png" alt="">
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/2.png" alt="">
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/3.png" alt="">
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/4.png" alt=""></p>
<h2 id="0x03-后台入口">0x03 后台入口</h2>
<p>后台路径没改，直接输入admin就进去了，有些后台是要后面接认证码的，不过也可以进去的，等会看日志就懂了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/5.png" alt="">
这里做了验证码的判断，懒得去爆破了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/6.png" alt=""></p>
<h2 id="0x04-日志文件泄露">0x04 日志文件泄露</h2>
<p>翻了下t00ls关于thinkcmf的漏洞，有个日志的可以查看到sql执行的记录。日志存放的位置
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/7.png" alt="">
访问路径<code>data/runtime/Logs/Admin/18_05_09.log</code>，后面接上的是年月日。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/8.png" alt="">
我们来找一下管理员的账号密码，cmf的加密方式为两种，现在这款用的是<code>###+两次MD5加密(认证码+密码)</code>
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/9.png" alt="">
我们从日志找到的SQL执行日志
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/10.png" alt="">
解密可以去https://cmd5.la/ss/
或者直接写脚本跑，一般认证码都是不变的，只要跑后面的密码就行了。
搞到账号密码直接登录后台进行拿shell的过程了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/11.png" alt=""></p>
<h2 id="0x05-getshell">0x05 Getshell</h2>
<p>本来想在后台的配置文件里面写shell进去的
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/12.png" alt="">
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/13.png" alt="">
后来朋友直接扔了一个编辑器过来，地址：<code>index.php/Portal/AdminPage/add</code>
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/14.png" alt="">
因为有后台权限，直接访问<code>index.php/Admin/Setting/upload</code>修改允许上传的后缀
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/15.png" alt="">
然后写了一个一句话上传，用C刀连接，大功告成！
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/16.png" alt=""></p>
<h2 id="0x06-结束">0x06 结束</h2>
<p>这种棋牌游戏前段时间是相当的火，这个只是一个台子的帐，其他的还不晓得有多暴利。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/H5ss/17.png" alt=""></p>
</div>
<div style="position: fixed; right:50px; max-width:255px; overflow:auto; top: 120px; width: 220px; bottom:90px">










<div class="toc">

    <div class="page-header"><strong>目录</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x01-%e5%89%8d%e8%a8%80">
                            0x01 前言
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x02-%e5%bc%80%e5%a7%8b">
                            0x02 开始
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x03-%e5%90%8e%e5%8f%b0%e5%85%a5%e5%8f%a3">
                            0x03 后台入口
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x04-%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e6%b3%84%e9%9c%b2">
                            0x04 日志文件泄露
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x05-getshell">
                            0x05 Getshell
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#0x06-%e7%bb%93%e6%9d%9f">
                            0x06 结束
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        

    </div>

</div>



</div>

  </article>
</main>
<footer>
  <div>
    <div>&copy; 2021 F0rmat. <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC-BY-4.0</a></div>
  </div>
</footer>
</body>
</html>
